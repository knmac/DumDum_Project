package fr.eurecom.allmenus;

import android.graphics.Point;

import java.util.LinkedList;

import com.minigolf.MainActivity.StateList;

import fr.eurecom.dumdumgame.Button;
import fr.eurecom.dumdumgame.DynamicBitmap;
import fr.eurecom.dumdumgame.MainActivity;
import fr.eurecom.utility.Parameters;
import android.graphics.Canvas;
import android.graphics.Point;
import android.widget.EditText;

public class StartMenu extends BaseMenu {
	private enum ButtonID {
		ADD_USER, RETURN
	};

	private EditText txtAddUser;

	public StartMenu(DynamicBitmap bmpBackground, Object o) {
		super(bmpBackground);
		Button btnReturn = new Button(ButtonID.RETURN,
				Parameters.bmpBtnReturn, Parameters.posBtnReturn,
				Parameters.bmpBtnReturn.getWidth(),
				Parameters.bmpBtnReturn.getHeight());
		AddButton(btnReturn);

		Button btnAdd = new Button(ButtonID.ADD_USER, Parameters.bmpBtnAdd,
				Parameters.posBtnAdd, Parameters.bmpBtnAdd.getWidth(),
				Parameters.bmpBtnAdd.getHeight());
		AddButton(btnAdd);

		// set properties for new text box but not show it
		//txtAddUser = ((MainActivity) o).getTxtAddUser();
	}

	private void hideTextBox(Object o) {
		((MainActivity) o).getMainView().bringToFront();
		txtAddUser.setText("");
	}

	public void Show(Canvas canvas) {
		super.Show(canvas);

		// show text box
		txtAddUser.bringToFront();
	}

	@Override
	public boolean Action(Point p, Object o) {
		ButtonID ResultButtonID = (ButtonID) ClickedButton(p);

		if (ResultButtonID == null)
			return false;
		
		switch (ResultButtonID) {
		case ADD_USER:
			try {
				// Do a down on the mutex
				Parameters.mutex.acquire();
				// Critical region
				CallAddUser(o);
				// ----------------------
				// Do an up on the mutex
				Parameters.mutex.release();
			} catch (Exception e) {
				e.printStackTrace();
			}
			break;
		case RETURN:
			CallReturn(o);
			break;
		default:
			return false;
		}

		return true;
	}

	private void CallAddUser(Object o) throws Exception {
		String new_user_name = txtAddUser.getText().toString();
		this.hideTextBox(o);

		if (new_user_name.length() == 0) {
